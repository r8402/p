<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secretaria de Educação - Portal da Transparência</title>
    <link rel="icon" type="image/png" href="SEMES.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Cores Personalizadas para Tailwind */
        :root {
            --color-primary-green: #28a745;
            --color-secondary-blue: #007bff;
            --color-bg-white: #ffffff;
            --color-text-dark: #333333;
            --color-detail-lightgray: #f8f9fa;
            --color-border-document: #dee2e6;
        }

        /* Configurações Tailwind para usar variáveis CSS */
        @tailwind base;
        @tailwind components;
        @tailwind utilities;

        html, body {
            font-family: 'Inter', sans-serif; /* Usando Inter para um visual mais moderno */
            scroll-behavior: smooth;
        }

        /* Loading Spinner - Mantido com classes Tailwind e pequenas melhorias */
        .loading-spinner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.85); /* Mais opaco */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .loading-spinner.visible {
            opacity: 1;
            visibility: visible;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 48px; /* Maior */
            height: 48px; /* Maior */
            border-radius: 50%;
            border-left-color: var(--color-primary-green);
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-gray-100 text-gray-800">
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
    </div>

    <!-- Header Section -->
    <header class="relative bg-gradient-to-br from-green-600 to-blue-600 text-white p-8 md:p-12 text-center shadow-lg overflow-hidden flex flex-col items-center justify-center">
        <!-- Background Overlay for Effect -->
        <div class="absolute inset-0 bg-white opacity-5 transform -skew-y-3 z-0"></div>
        
        <h1 class="text-4xl md:text-5xl font-extrabold mb-2 relative z-10 flex items-center justify-center gap-3">
            <i class="fas fa-graduation-cap text-green-200"></i> Portal da Transparência
        </h1>
        <p class="text-lg md:text-xl font-light mb-8 relative z-10">Secretaria de Educação</p>
        
        <!-- Search Bar -->
        <div class="relative z-10 flex w-full max-w-xl shadow-md rounded-lg overflow-hidden">
            <input 
                type="text" 
                id="searchInput" 
                placeholder="Pesquisar documentos por título ou descrição..." 
                class="flex-grow p-3 text-lg bg-white bg-opacity-20 text-white placeholder-gray-200 border-none focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all duration-200"
            >
            <button 
                id="searchButton" 
                class="bg-white text-blue-600 px-5 py-3 text-lg font-semibold hover:bg-blue-100 transition-colors duration-200 flex items-center gap-2"
            >
                <i class="fas fa-search"></i>
            </button>
        </div>
    </header>

    <!-- Main Content Container -->
    <div class="container mx-auto p-4 md:p-8 pt-6 md:pt-10 flex-grow"> 
        
        <!-- Document Grid -->
        <!-- Adicionado 'justify-center' para centralizar os balões (cards) em telas menores -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 justify-center" id="documentGrid">
            <!-- Os cards dos documentos serão inseridos aqui pelo JavaScript -->
            <p id="noPublicDocumentsMessage" class="text-center text-gray-600 text-xl col-span-full mt-8 hidden">
                Nenhum documento disponível no momento.
            </p>
        </div>
    </div>

    <!-- Footer Section -->
    <footer class="bg-gray-900 text-white text-center p-6 mt-12 shadow-inner">
        &copy; 2025 Secretaria de Educação. Todos os direitos reservados.
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

        // SUA CONFIGURAÇÃO FIREBASE (MANTIDA DO CÓDIGO ORIGINAL)
        const firebaseConfig = {
          apiKey: "AIzaSyChgagT-tMJk9QZjMybdhd7F0pPKPsO7FM",
          authDomain: "aprenda-b57c1.firebaseapp.com",
          databaseURL: "https://aprenda-b57c1-default-rtdb.firebaseio.com",
          projectId: "aprenda-b57c1",
          storageBucket: "aprenda-b57c1.firebasestorage.app",
          messagingSenderId: "757575583100",
          appId: "1:757575583100:web:5aa397f8178230e069d0f9",
          measurementId: "G-QEE5T90RM5"
        };
        
        // --- INICIALIZAÇÃO E LÓGICA DA PÁGINA ---
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const appId = firebaseConfig.projectId;

        let allPublicDocuments = []; // Armazena todos os documentos para filtragem

        // ELEMENTOS DO DOM
        const loadingSpinner = document.getElementById('loadingSpinner');
        const documentGrid = document.getElementById('documentGrid');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const noPublicDocumentsMessage = document.getElementById('noPublicDocumentsMessage');

        // --- FUNÇÕES AUXILIARES ---
        /**
         * Exibe o spinner de carregamento.
         */
        function showLoading() { 
            loadingSpinner.classList.add('visible'); 
        }

        /**
         * Oculta o spinner de carregamento.
         */
        function hideLoading() { 
            loadingSpinner.classList.remove('visible'); 
        }
        
        /**
         * Tenta converter uma URL do Google Drive para um formato incorporável (preview).
         * @param {string} url - A URL do documento.
         * @returns {string} A URL incorporável ou a URL original se não for do Drive.
         */
        function getEmbeddableUrl(url) {
            try {
                const urlObj = new URL(url);
                if (urlObj.hostname.includes('drive.google.com')) {
                    const pathParts = urlObj.pathname.split('/');
                    const fileIdIndex = pathParts.indexOf('d') + 1;
                    if (fileIdIndex > 0 && pathParts[fileIdIndex]) {
                        const fileId = pathParts[fileIdIndex];
                        return `https://drive.google.com/file/d/${fileId}/preview`;
                    }
                }
            } catch (e) {
                console.warn("URL inválida ou não conversível:", url);
            }
            return url; // Retorna a URL original se não for do Google Drive ou inválida
        }

        // --- FUNÇÕES DE RENDERIZAÇÃO ---
        /**
         * Cria e retorna um elemento de card de documento (div).
         * @param {object} doc - Objeto contendo os dados do documento (id, title, description, documentUrl, iconClass).
         * @returns {HTMLElement} O elemento div do card de documento.
         */
        function createDocumentCard(doc) {
            const card = document.createElement('div');
            // Classes Tailwind para estilização do card:
            // bg-white: fundo branco
            // rounded-xl: bordas arredondadas maiores
            // shadow-lg: sombra mais proeminente
            // overflow-hidden: esconde conteúdo que exceda as bordas
            // transform: permite transições suaves (para hover)
            // hover:scale-105: aumenta ligeiramente no hover
            // hover:shadow-2xl: sombra maior no hover
            // transition-all duration-300: transição suave para todas as propriedades em 300ms
            // flex flex-col: usa flexbox para organizar o conteúdo verticalmente
            // border-t-8 border-green-500: borda superior verde mais grossa
            card.className = 'bg-white rounded-xl shadow-lg overflow-hidden transform hover:scale-105 hover:shadow-2xl transition-all duration-300 flex flex-col border-t-8 border-green-500';
            
            const embedUrl = getEmbeddableUrl(doc.documentUrl);

            card.innerHTML = `
                <div class="p-5 md:p-6 bg-gray-50 border-b border-gray-200 flex items-center gap-4">
                    <i class="text-4xl ${doc.iconClass} text-blue-500"></i>
                    <h3 class="text-xl md:text-2xl font-semibold text-gray-900 flex-grow">${doc.title}</h3>
                </div>
                <div class="p-5 md:p-6 flex-grow">
                    <p class="text-gray-700 mb-4 text-base">${doc.description}</p>
                    <div class="w-full h-56 md:h-64 bg-gray-100 rounded-lg overflow-hidden border border-gray-300 flex items-center justify-center text-gray-500 text-sm">
                        <iframe 
                            src="${embedUrl}" 
                            title="Pré-visualização de ${doc.title}" 
                            loading="lazy" 
                            sandbox="allow-scripts allow-same-origin"
                            class="w-full h-full border-0"
                            onerror="this.src='https://placehold.co/400x250/F8F8F8/888888?text=Erro+ao+carregar+pr%C3%A9-visualiza%C3%A7%C3%A3o'"
                        ></iframe>
                    </div>
                </div>
                <div class="p-5 md:p-6 bg-gray-50 border-t border-gray-200 text-right">
                    <a 
                        href="${doc.documentUrl}" 
                        target="_blank" 
                        rel="noopener noreferrer"
                        class="inline-flex items-center gap-2 bg-green-600 text-white px-6 py-3 rounded-lg font-bold text-lg hover:bg-green-700 transition-colors duration-200 shadow-md hover:shadow-lg"
                    >
                        <i class="fas fa-download"></i> Baixar Documento
                    </a>
                </div>
            `;
            return card;
        }

        /**
         * Renderiza a lista de documentos no grid.
         * @param {Array<object>} documentsToRender - Array de objetos de documentos a serem exibidos.
         */
        function renderPublicDocuments(documentsToRender) {
            documentGrid.innerHTML = ''; // Limpa o grid
            if (documentsToRender.length === 0) {
                // Exibe mensagem de "nenhum documento" se não houver documentos ou a pesquisa não retornar resultados
                const message = searchInput.value.trim() 
                    ? `Nenhum documento encontrado para "<strong>${searchInput.value.trim()}</strong>".`
                    : "Nenhum documento disponível no momento.";
                noPublicDocumentsMessage.innerHTML = message;
                noPublicDocumentsMessage.classList.remove('hidden'); // Mostra a mensagem
            } else {
                noPublicDocumentsMessage.classList.add('hidden'); // Oculta a mensagem
                documentsToRender.forEach(doc => {
                    documentGrid.appendChild(createDocumentCard(doc));
                });
            }
        }

        /**
         * Filtra os documentos exibidos com base no termo de pesquisa.
         */
        function filterPublicDocuments() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const filtered = searchTerm
                ? allPublicDocuments.filter(doc =>
                    doc.title.toLowerCase().includes(searchTerm) ||
                    doc.description.toLowerCase().includes(searchTerm)
                )
                : allPublicDocuments; // Se o termo de pesquisa estiver vazio, exibe todos
            
            renderPublicDocuments(filtered);
        }

        // --- CARREGAMENTO INICIAL DOS DADOS ---
        /**
         * Carrega os documentos do Firebase Realtime Database.
         */
        function loadInitialData() {
            showLoading(); // Exibe o spinner
            const documentsRef = ref(db, `artifacts/${appId}/public/data/documents`);

            onValue(documentsRef, (snapshot) => {
                const fetchedDocuments = [];
                snapshot.forEach((childSnapshot) => {
                    fetchedDocuments.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });

                // Ordena os documentos pelos mais recentes (assumindo um timestamp existe)
                allPublicDocuments = fetchedDocuments.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                
                filterPublicDocuments(); // Renderiza os documentos (filtrados ou todos)
                hideLoading(); // Oculta o spinner
            }, (error) => {
                // Em caso de erro ao carregar dados
                console.error("Erro ao carregar documentos do Firebase:", error);
                noPublicDocumentsMessage.innerHTML = "Erro ao carregar os documentos. Tente novamente mais tarde.";
                noPublicDocumentsMessage.classList.remove('hidden');
                hideLoading();
            });
        }

        // --- EVENT LISTENERS ---
        // Adiciona um listener para cada vez que o usuário digita na barra de pesquisa
        searchInput.addEventListener('input', filterPublicDocuments);
        // Adiciona um listener para o clique no botão de pesquisa (também chama o filtro)
        searchButton.addEventListener('click', filterPublicDocuments);
        
        // Inicia a aplicação quando o DOM estiver completamente carregado
        window.addEventListener('load', loadInitialData);

    </script>
</body>
</html>

